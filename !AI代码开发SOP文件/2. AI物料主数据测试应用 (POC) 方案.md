## **AI物料主数据测试应用 (POC) 方案**

本方案旨在为开发一个概念验证（POC）应用提供清晰的指引，用于测试AI在创建和管理工程物料主数据方面的核心能力。

### **一、 测试应用架构**

整个测试应用可以分为三个核心模块，它们之间按顺序交互：

1. **模块一：ItemMaster创建器**  
   * **输入**: 用户提供一个URL链接、PDF文件或产品截图。  
   * **处理**: AI分析输入源，提取物料信息，并请求用户确认。  
   * **输出**: 在测试数据库中创建一条新的、标准化的物料记录。  
2. **模块二：BOQ解析器**  
   * **输入**: 用户上传一个简单的文本文件作为原BOQ或真BOQ（每行一个物料）。  
   * **处理**: AI读取每一行，调用ItemMaster进行智能匹配。**如果匹配失败，则触发“建议创建主物料”流程。**  
   * **输出**: 在数据库中生成带有物料ID关联的BOQ列表。  
3. **模块三：BOQ比对引擎**  
   * **输入**: 原BOQ和真BOQ的解析结果。  
   * **处理**: 通过比较两个BOQ列表中的物料ID，找出差异。  
   * **输出**: 显示一份清晰的变更报告（新增、删除、修改）。

### **二、 测试数据库结构**

为了测试，我们可以使用一个简化的数据库结构。

* **Test\_ItemMaster (中央物料库)**  
  * item\_id (主键, 自增)  
  * primary\_name (文本) \- 标准主名称  
  * full\_description (文本) \- AI提取并整理的完整规格  
  * source\_url (文本) \- 数据来源链接，便于追溯  
  * primary\_image\_url (文本) \- 标准图片链接。**注意：此URL应指向系统内部文件存储服务的永久链接，而非临时的外部网页链接，以防止失效。**  
  * text\_embedding (向量) \- **文本向量**，用于语义搜索  
  * image\_embedding (向量) \- **图像向量**，用于以图搜图  
* **Test\_ItemAliases (别名库)**  
  * alias\_id (主键, 自增)  
  * item\_id (外键, 关联到Test\_ItemMaster)  
  * alias\_name (文本) \- 物料的别名或俗称  
* **Test\_BOQs (BOQ存储库)**  
  * boq\_item\_id (主键, 自增)  
  * boq\_type (文本) \- 'Original' 或 'Actual'  
  * original\_text (文本) \- BOQ文件中的原始行文本  
  * item\_id (外键, 关联到Test\_ItemMaster) \- AI匹配到的物料ID  
  * quantity (数字) \- 数量

### **三、 核心AI交互与提示词 (Prompt) 设计**

这是整个测试的核心。

#### **1\. 创建ItemMaster的提示词**

当用户提供一个URL或文件时，后端应用调用AI。

**系统提示词 (System Prompt):**

你是一位精通工业品和工程材料的专家。你的任务是分析用户提供的内容（网页、文档或图片），并仅针对一个核心物料，提取其关键信息。你必须以严格的JSON格式返回结果。

JSON格式要求如下:  
{  
  "primary\_name": "这里填写最专业、最标准的物料主名称",  
  "full\_description": "这里填写所有提取到的技术规格、参数、材质、标准等，合并成一段详细的描述",  
  "aliases": \["这里填写该物料所有可能的别名、俗称、品牌名或不规范叫法"\],  
  "image\_url": "如果内容中有代表性的产品图片，请提取其URL"  
}

请直接输出JSON内容，不要包含任何解释性文字。

#### **2\. BOQ行项目匹配的提示词**

当用户上传BOQ文件，系统逐行处理时，调用此提示词。

**系统提示词 (System Prompt):**

你是一个物料匹配助手。根据用户输入的描述，从我提供的一系列“已知物料”中，找出最匹配的一项。

“已知物料”列表的格式为 \`\[{"id": 物料ID, "name": "主名称", "aliases": \["别名1", "别名2"\]}\]\`。

你必须返回最匹配项的ID，格式为 \`{"best\_match\_id": \<ID\>}\`。如果完全无法确定匹配项，则返回 \`{"best\_match\_id": null}\`。

\---  
\*\*已知物料:\*\*  
\[  
  {"id": 101, "name": "盲板法兰", "aliases": \["Blind plate", "dummy", "闷板", "铁饼"\]},  
  {"id": 102, "name": "六角头螺栓", "aliases": \["Hex bolt", "外六角螺丝"\]},  
  {"id": 103, "name": "无缝钢管", "aliases": \["Seamless Steel Pipe"\]}  
\]

\---  
\*\*用户输入:\*\*

用户输入 (User Input):  
(这里由应用填入BOQ文件中的一行，例如: DN50的dummy 20个)

#### **3\. 建议创建主物料功能的工作流 (当匹配失败时)**

当“模块二：BOQ解析器”在ItemMaster中找不到与BOQ行项目高置信度匹配的物料时，此自动化流程将被触发。

1. **触发**: 系统判定某个BOQ行项目（例如 “法兰克减速机, 型号A05B”）为新品。  
2. **AI自动填充**: 系统将该行文本作为输入，调用AI进行网络搜索和知识库查询。  
   * **系统提示词 (System Prompt):**  
     你是一位工业品采购专家。根据用户提供的物料描述，请在网络上搜索该产品的详细信息，并以严格的JSON格式返回。你需要找到它的标准名称、技术规格、可能的别名，以及一张最具代表性的产品图片URL。

     用户输入: "法兰克减速机, 型号A05B"

     JSON格式要求:  
     {  
       "primary\_name": "（例如：FANUC 机器人减速机）",  
       "full\_description": "（例如：型号A05B-2601-H111，适用于FANUC M-1iA系列机器人，高精度谐波减速器...）",  
       "aliases": \["（例如：发那科减速机, Fanuc Reducer）"\],  
       "image\_url": "（找到的图片URL）"  
     }

3. **弹出建议窗口**: 系统弹出一个“创建新物料”的窗口，并将AI返回的primary\_name, full\_description, aliases 和 image\_url 预先填充到对应的输入框和图片预览区。  
4. **用户审核与修改**: 录入员可以：  
   * 修改所有文本字段。  
   * 保留AI建议的图片。  
   * 通过粘贴新URL来更换图片。  
   * 直接上传本地图片文件。  
5. **确认创建与后台处理 (核心步骤)**: 用户点击“创建”后，后台执行以下操作：  
   * **图片处理**:  
     * 无论是URL还是上传的文件，系统都会将图片下载到服务器。  
     * **自动缩放**: 将图片统一处理成标准分辨率（例如 256x256 像素），以优化存储和加快比对速度。  
     * **持久化存储**: 将处理后的图片上传到内部文件存储服务（如Firebase Storage, AWS S3），并获得一个**永久、可靠的内部URL**。  
   * **向量生成**:  
     * 将**处理后的图片**发送给Gemini Embedding API，生成image\_embedding。  
     * 将用户最终确认的文本信息（primary\_name \+ full\_description）发送给API，生成text\_embedding。  
   * **数据库写入**: 将所有信息（包括新的内部图片URL和两个向量）存入Test\_ItemMaster和Test\_ItemAliases表。  
   * **关联BOQ**: 将新生成的item\_id更新到当前处理的Test\_BOQs记录中，完成关联。

### **四、 向量语义的实现**

1. **生成向量**:  
   * 当一个新物料被确认并存入Test\_ItemMaster时，应用后台需要调用Gemini的**Embedding API**。  
   * 将primary\_name和full\_description合并，发送给API，获得返回的text\_embedding向量。  
   * 如果用户确认了图片，将**处理后的图片**发送给API，获得image\_embedding向量。  
   * 将这两个向量存入数据库。  
2. **搜索向量**:  
   * 当需要为BOQ行项目做模糊匹配时，更高级的做法是：  
   * 先将BOQ行项目（如“DN50的dummy”）也转换成一个向量。  
   * 在数据库中计算这个新向量与Test\_ItemMaster里所有text\_embedding的**余弦相似度 (Cosine Similarity)**。  
   * 找出相似度最高的Top 3，然后将这3个候选物料作为“已知物料”喂给上面的**BOQ行项目匹配提示词**，让AI做最终的精准选择。这比把整个库都给AI要高效得多。

### **五、 其他关键点 (您没提到但很重要)**

* **用户界面 (UI)**: 测试应用也需要一个简单的界面，至少包含：  
  * 一个输入框用于粘贴URL，一个按钮用于上传文件。  
  * 一个区域用于展示AI提取的JSON结果和图片，供用户审核。  
  * “确认存入”和“放弃”按钮。  
  * 两个“上传BOQ”按钮。  
  * 一个最终的“比对结果”展示区。  
* **“冷启动”问题**: 您的测试数据库一开始是空的。您需要先通过**模块一**，手动录入10-20个常见的、不同种类的物料，来建立一个初步的ItemMaster。这个过程本身就是非常有价值的测试。