# **通过 Cloudflare Tunnel 实现永久公网访问本地服务 SOP (V11.1 \- 优化自启版)**

## **一、 目标**

本 SOP 旨在指导用户如何通过**创建批处理脚本 (.bat) 并利用 Windows 开机自启动文件夹**，将运行在个人电脑上的本地服务（如 http://localhost:8000），安全、稳定地发布到公网。**此版本为最终版，采用了最简单、最可靠的自启动方案，并优化了启动体验，使脚本窗口自动最小化。**

## **二、 核心优势**

* **极简设置**: 无需处理复杂的服务安装、系统路径和防火墙权限问题。  
* **100% 可靠**: 直接运行我们手动测试成功过的命令，确保结果一致。  
* **易于管理**: 所有配置文件均存放在您自己的用户文件夹下，方便修改。  
* **体验优化**: 开机后脚本窗口自动最小化，不干扰正常使用。

## **三、 操作步骤**

### **阶段一：确认隧道信息和配置文件**

此阶段确保我们的基础配置是正确的。

1. **确认隧道和域名已连接**  
   * 请确保您已按照之前的步骤，成功创建了隧道，并已将您的子域名 (laptop.teaforia.in) 路由到该隧道。  
2. **确认配置文件位置和内容**  
   * 请确保您的 config.yml 文件和 .json 凭证文件，都存放在您的用户配置文件夹中。  
   * **路径**: C:\\Users\\eric peng\\.cloudflared\\  
   * **config.yml 内容 (参考)**:  
     tunnel: 357bab7a-97f0-4a6b-b7a5-aa94fca2346a  
     ingress:  
       \- hostname: laptop.teaforia.in  
         service: http://localhost:8000  
       \- service: http\_status:404

### **阶段二：创建自启动批处理脚本 (.bat) (核心步骤)**

1. **创建脚本文件**  
   * 在您的桌面上，点击右键 \-\> 新建 \-\> 文本文档。  
   * 将这个新文件重命名为 start-tunnel.bat。（注意，后缀名是 .bat 而不是 .txt）  
2. **编辑脚本内容 (已优化)**  
   * 在 start-tunnel.bat 文件上点击右键，选择“编辑”。  
   * 将以下**优化后**的命令完整地复制并粘贴进去，它会让命令行窗口在启动后自动最小化：  
     start /min "Cloudflare Tunnel" cloudflared tunnel \--config "C:\\Users\\eric peng\\.cloudflared\\config.yml" run

   * 保存并关闭文件。

### **阶段三：设置开机自启动**

1. **打开“运行”对话框**  
   * 按下键盘上的 Win \+ R 键。  
2. **进入启动文件夹**  
   * 在“运行”对话框中，输入 shell:startup 然后按回车。  
   * 这会打开一个名为“启动”的文件夹。  
3. **放置脚本**  
   * 将您刚刚在桌面上创建的 start-tunnel.bat 文件，**剪切并粘贴**到这个“启动”文件夹中。

### **阶段四：清理并验证**

1. **清理旧的服务**  
   * 打开一个**管理员命令提示符 (cmd.exe)**。  
   * 运行 sc delete Cloudflared，确保之前所有失败的服务都已被彻底删除。如果提示服务不存在，则是最好的状态。  
2. **重启电脑**  
   * 现在，请**重新启动您的电脑**。  
3. **最终验证**  
   * 当您重启并登录 Windows 后，系统会自动运行“启动”文件夹里的 start-tunnel.bat 脚本。  
   * 您会看到一个黑色的命令行窗口短暂弹出后，便会自动**最小化到任务栏**。**请保持这个最小化的窗口不要关闭**。  
   * 此时，打开浏览器，访问您的域名 https://laptop.teaforia.in。  
   * 您应该可以成功看到您本地的服务界面。问题已彻底解决。

**SOP 结束**